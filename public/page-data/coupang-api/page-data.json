{
    "componentChunkName": "component---src-templates-post-template-tsx",
    "path": "/coupang-api/",
    "result": {"data":{"allMarkdownRemark":{"edges":[{"node":{"html":"<h1>Python 쿠팡 API Package 401 Unauthorized 오류 처리</h1>\n<p>Coupang은 <a href=\"https://developers.coupangcorp.com/hc/ko\">Open API</a>를 제공하는 플랫폼 중 하나다.</p>\n<p>필요한 부분만 딱 빼서 따로 기능을 넣어도 되지만 난 보통 Open API를 사용할때 일단 미리 능력자 분들이 만들어 놓은 패키지가 있지 않을까 구글링을 먼저 해본다.</p>\n<p><a href=\"https://pypi.org/project/coupang/\" rel=\"Coupang API Python Package\"><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 768px; \"\n    >\n      <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 72.91666666666666%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAABYlAAAWJQFJUiTwAAACm0lEQVQ4y42Qy08TURTGb6EEIlETXejSxEeMiYkblrrVlQvhPxDkoRRKgSIQVMSwIGpiFGUhBqIBCxXkVVqhaNSFEDGIbIjS2GlLhU7baYe28/zM3FIomhJu8suZOfee73znkAvt/chvnEL98CJaxpdwx76MtqlfuPvuJ41tjmWcav8AUjUBXe0kiMmG7LpJ5DU4kH/TgTyzHXkNNhxoskNfZwM5c9sCUjWKS52fcLnrM648/4KiF3Mo7J5FYfccirpncbTFDmIYgc44ClI9SqO+Zgw5pjFk14xDV+1ElnEGpHoS5EizA8db7cg1jUBvfAtS8hrkah9Icf82FQPQVQ6C3EhnAOS6FTrDS+w31+Jwkwm5NY9BzjZbce7WEE43DuKk2YJDRguyDG+gr9omy2CFrjINg5XmSOUQ9pn6cKy1ASfu1eOguRNEV9IDUtyD7Gu9yCntBSl9BVI2AFJm2RsVVpAKG0j5BEj5MMgD2zfcn5iHFjvGv+KRYwFdM0t45vyxJ55Oa3xP4lwEUaMsEOcAIQLEw1BiEShxHqpGIgmE2J4h04suLHjCmGdCmPsdBJ+QEGBZrPr/wOtbxTrLQpRliFIacmZIQYcTF598xPmH71HQMQ1XgAfPhRHmOGhHURSkH1VVIctyRgjD8mCCPPiECEFKJtfW1uD3+xEOhxEMBrG+vg6WZREIBBCJRGiTjILaiNG4QH9URaGPNQGXy4WVlRX4fD5wHEeFNcFoNLpDUNmsSUGCbACikKCXoiQlhVWVOnK73dRtLBb7b+R/hbYE/SEe3EaCukvvqjnyer3UXSgUouNLmw133WGU34AkK5AliRakOmkiDMNsCQmCkNHVDocM46Z70YpEUaRo39q+PB4PFU7lUve78Rd7e9VDDQUNZwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/62fac924b6979a2bbabc29b76884e898/a59e9/coupang-api-package.webp 192w,\n/static/62fac924b6979a2bbabc29b76884e898/0ca9f/coupang-api-package.webp 384w,\n/static/62fac924b6979a2bbabc29b76884e898/dc9b9/coupang-api-package.webp 768w,\n/static/62fac924b6979a2bbabc29b76884e898/e2c2f/coupang-api-package.webp 1152w,\n/static/62fac924b6979a2bbabc29b76884e898/f3efb/coupang-api-package.webp 1536w,\n/static/62fac924b6979a2bbabc29b76884e898/22125/coupang-api-package.webp 2244w\"\n              sizes=\"(max-width: 768px) 100vw, 768px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/62fac924b6979a2bbabc29b76884e898/3b721/coupang-api-package.png 192w,\n/static/62fac924b6979a2bbabc29b76884e898/66595/coupang-api-package.png 384w,\n/static/62fac924b6979a2bbabc29b76884e898/fe486/coupang-api-package.png 768w,\n/static/62fac924b6979a2bbabc29b76884e898/d2d74/coupang-api-package.png 1152w,\n/static/62fac924b6979a2bbabc29b76884e898/e8464/coupang-api-package.png 1536w,\n/static/62fac924b6979a2bbabc29b76884e898/73968/coupang-api-package.png 2244w\"\n            sizes=\"(max-width: 768px) 100vw, 768px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/62fac924b6979a2bbabc29b76884e898/fe486/coupang-api-package.png\"\n            alt=\"Coupang API Python Package\"\n            title=\"Coupang API Python Package\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n    </span></a></p>\n<p>Eureka! 역시 어떤 능력자 분이 먼저 만들어 놓으셨구나 ㅋㅋ 종종 API 공급 플랫폼 자체에서 패키지를 만들어 제공하는 경우는 있긴하지만 쿠팡은 없는 것 같다.</p>\n<p>적용 하는 방법은 아래 깃헙 리포 README.md에 잘 설명되어 있어서 패스~ <br />\n<a href=\"https://github.com/kyungdongseo/coupang\"><a href=\"https://github.com/kyungdongseo/coupang\" target=\"_blank\" rel=\"nofollow\">https://github.com/kyungdongseo/coupang</a></a><br /><br /></p>\n<p>내가 필요한 부분은 정산프로그램에 사용할 예정이기 때문에 정산API에서 히스토리 불러오는 함수를 import해서 결과값 출력 테스트</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">from coupang.settlement import settlement_histories\n\nfor history in settlement_histories({'revenueRecognitionYearMonth': '2022-03'}):\n    print(history)\n\nfor history in settlement_histories({'revenueRecognitionYearMonth': '2022-04'}):\n    print(history)</code></pre></div>\n<p>경건한 마음으로 프로그램을 실행해 본다. (이때가 가장 떨림)</p>\n<p>아니나 다를까 <strong>401 Unauthorized</strong> 에러를 뱉으며 줄줄이 올라오는 오류 메세지.. 이게 무슨일 일까 쿠팡에서 그새 API를 수정한 건지 살펴본다. 하지만 찾을 수 없다. 뭐가 문젤까 오류 메세지를 살펴보지만 모르겠다.<br /><br /></p>\n<p>열심히 구글링을 한 결과 지금은 어디였는지 기억이 안나지만 한 블로그 웹페이지에서 파이썬 샘플 코드 타임존 수정에 오류가 있다는 글을 보고 변경 적용해 봤는데 결과적으론 정보 불러오기 성공! 누구신지 커피한잔 사드리고 싶네 ㅠ<br />\n<a href=\"https://developers.coupangcorp.com/hc/ko/articles/360033396034-Python-Example\">파이썬 샘플코드</a><br /><br /></p>\n<p>패키지 안에 coupang/common.py의</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">def date_time():\n    os.environ['TZ'] = 'GMT+0'\n    return time.strftime('%y%m%d')+'T'+time.strftime('%H%M%S')+'Z'</code></pre></div>\n<p>서버 시간을 GMT 기준시간으로 변경해서 string 포맷으로 return하는 부분을 찾아 아래 처럼 변경해 주면 된다! 위 코드를 MacOS에선 정상적으로 실행되지만\n윈도우와 Ubuntu(Linux)에서는 Python 코드로는 타임존 수정이 안되서 제대로 적용이 되질 않는다. timedelta 함수를 이용해서 변경해주는 코드로 변경해주면 정상적으로 실행되는 것을 확인 할 수 있다!</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">def date_time():\n    from datetime import datetime, timedelta\n\n    gmt_time = datetime.now() - timedelta(hours=9) #한국기준\n    gmt_time_str = \"{:%y%m%d}T{:%H%M%S}Z\".format(gmt_time, gmt_time)\n\n    return gmt_time_str\n    </code></pre></div>\n<p>정산API 외 다른 API 메서드 들은 확인은 해보진 않았지만 정상적으로 작동 될걸로 예상된다!</p>","frontmatter":{"title":"Coupang Open API Unauthorized","summary":"Python 쿠팡 API Package 401 Unauthorized 오류 처리","date":"2022.04.10.","categories":["Coupang","Open API","Error"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/jpeg;base64,/9j/2wBDAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/2wBDAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQH/wgARCAAMABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAYDBwn/xAAVAQEBAAAAAAAAAAAAAAAAAAAFBP/aAAwDAQACEAMQAAAB16YbgjgSXBkExv/EABsQAAMAAgMAAAAAAAAAAAAAAAIEBQABAwYH/9oACAEBAAEFAnfQp6DyHcVaC8mpx11cEBAdCI5//8QAIREAAwACAQMFAAAAAAAAAAAAAQIDBBIUBRExEyEiQVL/2gAIAQMBAT8B5HTeLeZ6dTlOqCGSM19IkCm7tH0iKli0zqWUfA+47nvjpacJJkVF7qoFbLMSFW+3EwSJg/jZtfGzeT//xAAcEQACAwEAAwAAAAAAAAAAAAABAgMREgQAMVL/2gAIAQIBAT8B6oO6UKObuXlOwXY8qTkppSUUO6qpKhlDnWdXlq8laNpHaKMxRk2kZYuUHzs0Wr6oX7oevP/EACQQAAICAgEEAQUAAAAAAAAAAAECAxEEEgUAEyFBMRQiIzJR/9oACAEBAAY/ApcOfjuSqHKycWSeMYzrF9NMYGnmjE/fhx9lMm8iDXGmwclh28/HuHIh4/kanGyoyQ2B21lIcrKUDohZZY9i0U6NjvUhWzlwxSwoJpIQs+ok/HX3FFZil3+r6v7rUqzdBUUIo+FUBVHvwB4+em1UDc7NQA2aguzf00oFnzQA9df/xAAbEAEBAAMAAwAAAAAAAAAAAAABEQAhMUFxkf/aAAgBAQABPyGNbTeuepGVgZgkalKZS3IgJzJ6a6cu/CizJtwE9/XLZr2QKowVKw2q9ccSddjdgB73bdAH/9oADAMBAAIAAwAAABDY/wD/xAAZEQEAAgMAAAAAAAAAAAAAAAABABEhMVH/2gAIAQMBAT8QMAEYBboRREIAoKHtRt6Gig6ES//EABgRAQEAAwAAAAAAAAAAAAAAAAERACFR/9oACAECAQE/EAJ4a+NCOhQNgY3I6FIRAnYpO3H/xAAZEAEBAQADAAAAAAAAAAAAAAABEQAhoeH/2gAIAQEAAT8QUaPOwVMPqFVgqpAXLXtu50xWdxeAjJA1tash7eFmPLANEQBw4RRUW2TrSo5Edulc/9k="},"images":{"fallback":{"src":"/static/69d565b01f976ce8a5f4d566a705d48f/e0bd6/coupang-image.jpg","srcSet":"/static/69d565b01f976ce8a5f4d566a705d48f/b6d47/coupang-image.jpg 100w,\n/static/69d565b01f976ce8a5f4d566a705d48f/3bc87/coupang-image.jpg 199w,\n/static/69d565b01f976ce8a5f4d566a705d48f/e0bd6/coupang-image.jpg 398w","sizes":"(min-width: 398px) 398px, 100vw"},"sources":[{"srcSet":"/static/69d565b01f976ce8a5f4d566a705d48f/6425b/coupang-image.webp 100w,\n/static/69d565b01f976ce8a5f4d566a705d48f/f427a/coupang-image.webp 199w,\n/static/69d565b01f976ce8a5f4d566a705d48f/50d49/coupang-image.webp 398w","type":"image/webp","sizes":"(min-width: 398px) 398px, 100vw"}]},"width":398,"height":232}}},"publicURL":"https://kyong-dev.github.io"}}}]}},"pageContext":{"slug":"/coupang-api/"}},
    "staticQueryHashes": []}